<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Sharing Yatra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
        }

        /* --- Animated Gradient Title --- */
        .animated-gradient {
            background-size: 200% auto;
            animation: gradient-flow 4s ease-in-out infinite;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(to right, #2563eb, #4f46e5);
        }

        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Main Card Hover Effect --- */
        .auth-card {
            transition: all 0.3s ease-in-out;
        }
        .auth-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.04);
        }

        /* --- Form Input Focus Style --- */
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="password"]:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
            ring-width: 0;
        }
        
        /* --- Primary Button (No @apply) --- */
        .btn-primary {
            background-image: linear-gradient(to right, #2563eb, #4f46e5);
            border: none;
            box-shadow: 0 4px 15px -3px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease-in-out;
        }
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px -3px rgba(59, 130, 246, 0.4);
            background-image: linear-gradient(to right, #3b82f6, #6366f1);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: translateY(0);
        }

        /* --- Alert Message Styling --- */
        #alertMessage {
            font-weight: 500;
        }
        .alert-success {
            background-color: #f0fdf4; /* green-50 */
            color: #166534; /* green-800 */
            border: 1px solid #bbf7d0; /* green-200 */
        }
        .alert-error {
            background-color: #fef2f2; /* red-50 */
            color: #991b1b; /* red-800 */
            border: 1px solid #fecaca; /* red-200 */
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8 sm:p-10 auth-card">
        
        <h1 class="text-4xl sm:text-5xl font-bold text-center animated-gradient mb-2">
            Sharing Yatra
        </h1>
        <h2 class="text-xl font-medium text-center text-gray-700 mb-6">Reset Your Password</h2>

        <p class="text-center text-gray-500 mb-6 text-sm">
            Enter your email, phone, and new password. We will reset it if the email and phone match.
        </p>

        <!-- Alert Message Area -->
        <div id="alertMessage" class="hidden mb-4 p-3 rounded-lg text-sm"></div>

        <form id="resetForm" class="space-y-5">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <!-- Input with icon -->
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                        </svg>
                    </div>
                    <input type="email" id="email" name="email" 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" 
                           required>
                </div>
            </div>
            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number (10 digits)</label>
                <!-- Input with icon -->
                <div class="relative">
                     <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <!-- THIS SVG ICON HAS BEEN CHANGED -->
                        <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75A2.25 2.25 0 0015.75 1.5h-2.25m-3 0V3m3 0V3m-3 0h3m-3 18h3" />
                        </svg>
                    </div>
                    <input type="tel" id="phone" name="phone" 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" 
                           pattern="[0-9]{10}" title="Phone number must be exactly 10 digits" required>
                </div>
            </div>
            <div>
                <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                <!-- Input with icon AND password toggle -->
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 00-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                        </svg>
                    </div>
                    <input type="password" id="newPassword" name="newPassword" 
                           class="w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200" 
                           required>
                    <!-- Password Toggle Button -->
                    <button type="button" id="togglePassword"
                        class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"
                        aria-label="Toggle password visibility">
                        <svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-.07.207-.07.431 0 .639C20.268 16.057 16.478 19 12 19c-4.478 0-8.268-2.943-9.542-7a1.012 1.012 0 010-.639z"></path></svg>
                        <svg id="eyeSlashedIcon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a1.012 1.012 0 010-.639C3.732 7.943 7.523 5 12 5c1.267 0 2.49.26 3.618.734m2.196 2.196a10.004 10.004 0 014.186 3.07M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.879 4.879l14.242 14.242"></path></svg>
                    </button>
                </div>
            </div>
            <div class="pt-2">
                <button type="submit" id="submitButton"
                    class="btn-primary w-full block text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-300">
                    Reset Password
                </button>
            </div>
            <div class="text-center mt-4">
                <a href="/login.html" class="text-sm font-medium text-blue-600 hover:underline">Back to Login</a>
            </div>
        </form>
    </div>

    <script>
        const resetForm = document.getElementById('resetForm');
        const submitButton = document.getElementById('submitButton');
        const alertMessage = document.getElementById('alertMessage');

        resetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitButton.disabled = true;
            submitButton.textContent = 'Resetting...';
            alertMessage.classList.add('hidden');

            const formData = new FormData(resetForm);
            const data = Object.fromEntries(formData.entries());

            try {
                // This calls the POST route
                const res = await fetch('/api/forgot-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await res.json();

                if (!res.ok) {
                    throw new Error(result.message || 'An error occurred.');
                }
                
                showAlert(result.message, 'success');
                resetForm.reset();

            } catch (err) {
                showAlert(err.message, 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Reset Password';
            }
        });

        function showAlert(message, type) {
            alertMessage.textContent = message;
            alertMessage.classList.remove('hidden', 'alert-success', 'alert-error');
            
            if (type === 'success') {
                alertMessage.classList.add('alert-success');
            } else {
                alertMessage.classList.add('alert-error');
            }
        }

        // --- NEW: Password Toggle Logic ---
        function setupPasswordToggle(inputId, toggleButtonId, eyeIconId, eyeSlashedIconId) {
            const input = document.getElementById(inputId);
            const toggleButton = document.getElementById(toggleButtonId);
            const eyeIcon = document.getElementById(eyeIconId);
            const eyeSlashedIcon = document.getElementById(eyeSlashedIconId);

            if (input && toggleButton && eyeIcon && eyeSlashedIcon) {
                toggleButton.addEventListener('click', () => {
                    const isPassword = input.type === 'password';
                    input.type = isPassword ? 'text' : 'password';
                    eyeIcon.classList.toggle('hidden', isPassword);
                    eyeSlashedIcon.classList.toggle('hidden', !isPassword);
                });
            }
        }

        // --- Initialize the password toggle ---
        setupPasswordToggle(
            'newPassword',
            'togglePassword',
            'eyeIcon',
            'eyeSlashedIcon'
        );
    </script>
</body>
</html>

